<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div>
    <button onclick="clickMe()">获取权限</button>
    <button onclick="connectToWebSocket()">Connect</button>

    <p id="system_type">系统类型</p>
    <p id="z">z轴</p>
    <p id="x">x轴</p>
    <p id="y">y轴</p>

    <label for="wsUrl">WebSocket URL:</label>
    <input type="text" id="wsUrl" placeholder="Enter WebSocket URL">
    <label for="wsPort">Port:</label>
    <input type="text" id="wsPort" placeholder="Enter port number">
  </div>
  
</body>

</html>
    <script>
      
    var z = document.getElementById('z')
    var x = document.getElementById('x')
    var y = document.getElementById('y')
    var system_type = document.getElementById('system_type')

    var wsUrlInput = document.getElementById('wsUrl');
    var wsPortInput = document.getElementById('wsPort');
    var ws;
    function getSystemType() {
        var ua = navigator.userAgent;
        // 检查 Android 系统
        if (ua.indexOf('Android') > -1) {
            return 'Android';
        }
        // 检查 iOS 系统
        else if (ua.indexOf('iPad') > -1 || ua.indexOf('iPhone') > -1 || ua.indexOf('iPod') > -1) {
            return 'iOS';
        }
        // 检查 Windows 系统
        else if (ua.indexOf('Windows') > -1) {
            return 'Windows';
        }
        // 检查 macOS 系统
        else if (ua.indexOf('Mac') > -1) {
            return 'macOS';
        }
        // 检查 Linux 系统
        else if (ua.indexOf('Linux') > -1) {
            return 'Linux';
        }
        // 其他系统
        else {
            return 'Other';
        }
        
    }

    function clickMe() {
      var system_name=getSystemType()
      system_type.innerText = '系统类型: ' +system_name
      

      if (system_name==="iOS"){
        DeviceOrientationEvent.requestPermission().then(
          res => {
          // granted 是允许了    denied 是拒绝了
          console.log('res', res);
          if (res === 'granted') {
            console.log('允许了');
            window.addEventListener('deviceorientation', function (event) {
              // event.alpha 设备绕 z 轴旋转的角度(0 ~ 360)数字之间
              // event.beta 设备绕 x 轴旋转的角度(-180 ~ 180)数字之间
              // event.gamma 设备绕 y 轴旋转的角度(-90 ~ 90)数字之间
              z.innerText = 'z轴' + event.alpha
              x.innerText = 'x轴' + event.beta
              y.innerText = 'y轴' + event.gamma
            });
          }
          
          else {
            alert('没能获取权限，无法正常操作，请重新打开应用准许本次操作，方可正常操作')
          }
        }
      ).catch(err => 
      {
          console.log('err', err);
        }
      )
      }

      else if (system_name==="Android"){
        window.addEventListener('deviceorientation', function (event) {
              // event.alpha 设备绕 z 轴旋转的角度(0 ~ 360)数字之间
              // event.beta 设备绕 x 轴旋转的角度(-180 ~ 180)数字之间
              // event.gamma 设备绕 y 轴旋转的角度(-90 ~ 90)数字之间
              z.innerText = 'z轴' + event.alpha
              x.innerText = 'x轴' + event.beta
              y.innerText = 'y轴' + event.gamma
            })
      }
      else if (system_name==="Android" || system_name==="Linux"){
        getDeviceOrientation()
      }
    }
    
    function getDeviceOrientation() {
      if ('getDeviceOrientation' in navigator) {
          navigator.getDeviceOrientation().then(function (orientation) {
              updateText(orientation);
          });
      } else {
          alert('getDeviceOrientation 接口不支持');
      }
    }
    function updateText(orientation){
      x.innerText = orientation.x;
      y.innerText = orientation.y;
      z.innerText = orientation.z;
    }
  
     function connectToWebSocket() {
      var system_name = getSystemType();

      var wsUrl = wsUrlInput.value;
      var wsPort = wsPortInput.value;

      ws = new WebSocket('wss://' + wsUrl + ':' + wsPort);

      ws.onopen = function() {
        console.log('Connected to WebSocket server');
        sendXYZData();
      };

      ws.onclose = function() {
        console.log('Disconnected from WebSocket server');
      };
    }

   function sendXYZData() {
      setInterval(function() {
        var alpha = Math.round(Math.random() * 360 * 1000) / 1000; // Random value for demonstration
        var beta = Math.round(Math.random() * 180 * 1000) / 1000; // Random value for demonstration
        var gamma = Math.round(Math.random() * 90 * 1000) / 1000; // Random value for demonstration

        if (ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({ alpha: alpha, beta: beta, gamma: gamma }));
        }
      }, 1000);
    }

        

  </script>
</body>
